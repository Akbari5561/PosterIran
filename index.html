<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù¾ÙˆØ³ØªØ± Ø§ÛŒØ±Ø§Ù†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" href="/icons/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/icons/apple-touch-icon-167x167.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="theme-color" content="#8fb746">

  <meta property="og:title" content="Ù¾ÙˆØ³ØªØ± Ø§ÛŒØ±Ø§Ù†">
  <meta property="og:description" content="Ú†Ø§Ù¾ Ø§Ù†ÙˆØ§Ø¹ Ù¾ÙˆØ³ØªØ±Ù‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ">
  <meta property="og:image" content="/icons/og-image.jpg"> <meta property="og:url" content="https://akbari5561.github.io/PosterIran/">

  <style>

    h1 {
      color: #1976d2;
      cursor: pointer;
      margin: 0; /* Ø­Ø°Ù Ù…Ø§Ø±Ø¬ÛŒÙ† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ h1 Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø¨Ù‡ØªØ± ÙØ§ØµÙ„Ù‡ Ø¯Ø± ÙÙ„Ú©Ø³â€ŒØ¨Ø§Ú©Ø³ */
      font-size: 2em; /* Ø³Ø§ÛŒØ² ÙÙˆÙ†Øª h1ØŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯ */
    }

    body {
      font-family: sans-serif;
      direction: rtl;
      background: #f0f4f8;
      color: #333;
      padding: 20px;
      text-align: center;
      margin: 0; /* Remove default body margin */
      display: flex;
      flex-direction: column;
      min-height: 100vh; /* Ensure body takes full viewport height */
    }

    h1 {
      color: #1976d2;
      cursor: pointer;
    }

    button {
      background-color: #2196f3;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #1976d2;
    }
    button.remove-btn {
      background-color: #f44336;
    }
    button.remove-btn:hover {
      background-color: #d32f2f;
    }
    button.clear-cart-btn {
      background-color: #ff9800; /* Orange for clear cart */
    }
    button.clear-cart-btn:hover {
      background-color: #fb8c00;
    }
    /* Style for quantity dropdowns in both gallery and cart */
    .quantity-select {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin: 5px;
      width: 70px; /* Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ø¨Ø±Ø§ÛŒ Ø¬Ø§ Ø´Ø¯Ù† Ø¹Ø¯Ø¯ Ø³Ù‡ Ø±Ù‚Ù…ÛŒ */
      min-width: 50px; /* Ø­Ø¯Ø§Ù‚Ù„ Ø¹Ø±Ø¶ Ù…Ø¬Ø§Ø² */
      max-width: 80px; /* Ø­Ø¯Ø§Ú©Ø«Ø± Ø¹Ø±Ø¶ Ù…Ø¬Ø§Ø² */
      box-sizing: border-box; /* Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù¾Ø¯ÛŒÙ†Ú¯ Ùˆ Ø¨Ø±Ø¯Ø± Ø±ÙˆÛŒ Ø¹Ø±Ø¶ Ø­Ø³Ø§Ø¨ Ø¨Ø´Ù† */
      text-align: center; /* Ù…ØªÙ† Ø¯Ø§Ø®Ù„Ø´ ÙˆØ³Ø·â€ŒÚ†ÛŒÙ† Ø¨Ø´Ù‡ */
  }
    /* Style for the Group Selection dropdown */
    .group-select-fixed {
    width: 150px;   /* Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÙˆÙ¾â€ŒØ¯Ø§ÙˆÙ† Ú¯Ø±ÙˆÙ‡ */
    min-width: 120px; /* Ø­Ø¯Ø§Ù‚Ù„ Ø¹Ø±Ø¶ */
    max-width: 200px; /* Ø­Ø¯Ø§Ú©Ø«Ø± Ø¹Ø±Ø¶ */
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    margin: 5px;
    box-sizing: border-box; /* Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±Ø³Øª Ø¹Ø±Ø¶ */
    text-align: right; /* Ù…ØªÙ† Ø±Ø§Ø³Øªâ€ŒÚ†ÛŒÙ† Ø¨Ø§Ø´Ù‡ */
    }
    /* Main sections styling */
    #mainSection, #adminLogin, #gallery, #cartSection {
        margin-top: 20px;
        flex-grow: 1; /* Allow sections to take available space */
        display: none; /* Hidden by default, controlled by JS */
        flex-direction: column; /* For consistent layout */
    }
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø± Ú¯Ø§Ù„Ø±ÛŒ (Ø¬Ø¯ÛŒØ¯) */
    .quantity-input {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin: 5px;
      width: 70px; /* Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ø¨Ø±Ø§ÛŒ Ø¬Ø§ Ø´Ø¯Ù† Ø¹Ø¯Ø¯ Ø³Ù‡ Ø±Ù‚Ù…ÛŒ */
      min-width: 50px; /* Ø­Ø¯Ø§Ù‚Ù„ Ø¹Ø±Ø¶ Ù…Ø¬Ø§Ø² */
      max-width: 80px; /* Ø­Ø¯Ø§Ú©Ø«Ø± Ø¹Ø±Ø¶ Ù…Ø¬Ø§Ø² */
      box-sizing: border-box; /* Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù¾Ø¯ÛŒÙ†Ú¯ Ùˆ Ø¨Ø±Ø¯Ø± Ø±ÙˆÛŒ Ø¹Ø±Ø¶ Ø­Ø³Ø§Ø¨ Ø¨Ø´Ù† */
      text-align: center; /* Ù…ØªÙ† Ø¯Ø§Ø®Ù„Ø´ ÙˆØ³Ø·â€ŒÚ†ÛŒÙ† Ø¨Ø´Ù‡ */
    }
    
    /* Admin login is hidden by default, shown by JS only on title click */
    #adminLogin {
        display: none;
    }
    #cartSection {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      text-align: right;
    }
    #address {
      margin-top: 10px;
    }
    .image-box {
      background: white;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      width: calc(50% - 15px); /* Default for 2 items per row with gap */
      box-sizing: border-box; /* Include padding/border in width */
    }

    .image-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
      flex-grow: 1; /* Allow container to grow */
    }

    img {
      width: 100%;
      height: auto; /* Reverted to auto for original aspect ratio */
      border-radius: 8px;
      margin-bottom: 10px;
    }

    select, input[type="password"] {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin: 5px;
      width: calc(100% - 10px); /* Adjust width */
      box-sizing: border-box; /* Include padding/border in width */
    }
    
    .cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px dashed #eee;
    }
    .cart-item:last-child {
        border-bottom: none;
    }
    .quantity-control {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .cart-item-info {
        text-align: right;
        flex-grow: 1; /* Allow info section to take available space */
        margin-left: 10px; /* Space between info and controls */
    }
    .cart-item-actions {
        display: flex;
        align-items: center;
    }
    .cart-item-actions span {
        margin-left: 10px;
        font-weight: bold;
    }
    .cart-item-actions button {
      margin-left: 5px;
    }
    /* Controls at the top/bottom of gallery */
  .gallery-controls {
      display: flex;
    flex-wrap: wrap; /* Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø¨Ù‡ Ø®Ø· Ø¨Ø¹Ø¯ÛŒ Ø´Ú©Ø³ØªÙ‡ Ø´ÙˆÙ†Ø¯ */
    justify-content: center; /* Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± Ù…Ø±Ú©Ø² Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ */
    align-items: center;
    width: 100%;
    padding: 10px 0;
    background-color: #e0e7ff;
    border-top: 1px solid #c3d4e6;
    box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
    z-index: 1000;
    gap: 10px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ ÙÙ„Ú©Ø³ (wrapper Ùˆ Ø¯Ú©Ù…Ù‡) */
}
  .group-selection-wrapper {
      display: flex; /* Ø§ÛŒÙ† div Ø®ÙˆØ¯Ø´ ÛŒÚ© ÙÙ„Ú©Ø³â€ŒÚ©Ø§Ù†ØªÛŒÙ†Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ */
      align-items: center;
      gap: 5px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ù„ÛŒØ¨Ù„ Ùˆ Ø³Ù„Ú©Øª Ø¯Ø±ÙˆÙ¾â€ŒØ¯Ø§ÙˆÙ† */
      margin-right: 10px; /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø¯Ú©Ù…Ù‡ "Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯" (Ø§Ú¯Ø± Ø¯Ø± ÛŒÚ© Ø±Ø¯ÛŒÙ Ø¨Ø§Ø´Ø¯) */
  }
    #gallery-bottom-controls {
        margin-top: auto; /* Push to bottom of gallery content */
        position: sticky; /* Make it sticky */
        bottom: 0; /* Stick to the bottom */
        left: 0;
        right: 0;
        border-bottom: none; /* No bottom border for the very bottom one */
    }
    #gallery-top-controls {
        margin-bottom: 10px;
        border-top: none; /* No top border for the very top one */
        box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Shadow at the bottom */
    }
    .gallery-controls button {
        margin: 0;
    }
    .in-cart-display {
        font-size: 0.9em;
        color: #007BFF; /* Blue color for in-cart message */
        margin-top: 5px;
        font-weight: bold;
    }
@media (max-width: 600px) {
    .image-box {
        width: calc(100% - 10px);
    }
    .gallery-controls {
        flex-direction: column; /* Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù‡Ù…Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª Ø³ØªÙˆÙ†ÛŒ */
        gap: 10px;
    }
    .group-selection-wrapper {
        width: calc(100% - 20px); /* Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ØŒ wrapper Ù‡Ù… ØªÙ…Ø§Ù… Ø¹Ø±Ø¶ Ø´ÙˆØ¯ */
        justify-content: center; /* Ù…Ø­ØªÙˆØ§ÛŒ wrapper Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ ÙˆØ³Ø·â€ŒÚ†ÛŒÙ† Ø´ÙˆØ¯ */
        margin-right: 0; /* Ù…Ø§Ø±Ø¬ÛŒÙ† Ø­Ø°Ù Ø´ÙˆØ¯ */
    }
    .gallery-controls button {
        width: calc(100% - 20px);
    }
    /* Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ ØªØºÛŒÛŒØ± .gallery-controls select Ù†ÛŒØ³Øª Ø²ÛŒØ±Ø§ Ø¨Ø§ min/max-width Ú©Ù†ØªØ±Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ */
} 
  </style>
  
</head>
<body>

<h1 onclick="showAdminLogin()">Ù¾ÙˆØ³ØªØ± Ø§ÛŒØ±Ø§Ù†</h1>
<p id="subtitle">Ú†Ø§Ù¾ Ø§Ù†ÙˆØ§Ø¹ Ù¾ÙˆØ³ØªØ±Ù‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</p>
<div id="mainSection">
  <div id="address">
    <p>ØªÙ‡Ø±Ø§Ù† : Ø®ÛŒØ§Ø¨Ø§Ù† Ù¾Ø§Ù†Ø²Ø¯Ù‡ Ø®Ø±Ø¯Ø§Ø¯</p>
    <p>Ø¨Ø§Ø²Ø§Ø± Ø¢Ù‡Ù†Ú¯Ø±Ø§Ù† ØŒ Ú©ÙˆÚ†Ù‡ Ù…Ø³Ø¬Ø¯ Ø¬Ø§Ù…Ø¹</p>
    <p>Ù¾Ø§Ø³Ø§Ú˜ Ú©Ø§ØºØ° Ùˆ ØªØ­Ø±ÛŒØ± ØŒ Ø²ÛŒØ±Ø²Ù…ÛŒÙ† Ø§ÙˆÙ„ - Ù¾Ù„Ø§Ú© 74</p>
    <p>ØªÙ„ÙÙ€Ù†: 02155611875</p>
    <p>Ù…ÙˆØ¨Ø§ÛŒÙ„: 09010195885</p>
  </div>
  <div id="loginSection">
    <button onclick="enterAsUser()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú¯Ø§Ù„Ø±ÛŒ</button>
    <button onclick="showScreen('cart')">ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>
  </div>
  </div>

<div id="adminLogin">
  <input type="password" id="adminPassword" placeholder="Ø±Ù…Ø² ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†">
  <button onclick="loginAsAdmin()">ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†</button>
</div>

<div id="gallery">
  <div id="imagesContainer" class="image-container"></div>
  <div id="gallery-bottom-controls" class="gallery-controls">
  <div class="group-selection-wrapper"> <label for="bottomGroupSelect">Ø§Ù†ØªØ®Ø§Ø¨ Ú¯Ø±ÙˆÙ‡:</label>
    <select id="bottomGroupSelect" class="group-select-fixed" onchange="changeGroup(this.value)">
      <option value="1">Ø³Ø§ÛŒØ² Û²Û¹Ã—Û²Û± Ø¯ÙˆØ±ÙˆÚ†Ø§Ù¾</option>
      <option value="2">Ø³Ø§ÛŒØ² ÛµÛ°Ã—Û³Ûµ ÛŒÚ©Ø±ÙˆÚ†Ø§Ù¾</option>
      <option value="3">Ø³Ø§ÛŒØ² ÛµÛ°Ã—Û³Ûµ Ø¯ÙˆØ±ÙˆÚ†Ø§Ù¾</option>
      <option value="4">Ø³Ø§ÛŒØ² Û·Û°Ã—ÛµÛ° ÛŒÚ©Ø±ÙˆÚ†Ø§Ù¾</option>
      <option value="5">Ø³Ø§ÛŒØ² Û·Û°Ã—ÛµÛ° ÛŒÙˆÙˆÛŒâ€ŒØ¯Ø§Ø±</option>
      /*<option value="6">Ø³Ø§ÛŒØ± Ù…Ø­ØµÙˆÙ„Ø§Øª</option>*/
    </select>
  </div>
  <button onclick="showScreen('cart')">ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>
</div> </div>
<div id="cartSection">
  <h3>ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h3>
  <div id="cartList"></div>
  <p id="totalPrice" style="font-weight: bold; font-size: 1.1em; margin-top: 15px;"></p>

  <div class="customer-info-form" style="margin-top: 20px; text-align: right; background-color: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #eee;">
    <h4 style="margin-top: 0; margin-bottom: 15px; color: #333;">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ:</h4>
    <label for="customerName" style="display: block; margin-bottom: 5px; font-weight: bold;">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</label>
    <input type="text" id="customerName" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" required style="width: calc(100% - 20px); padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;">

    <label for="customerPhone" style="display: block; margin-bottom: 5px; font-weight: bold;">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„:</label>
    <input type="tel" id="customerPhone" placeholder="Û°Û¹Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹" required pattern="09[0-9]{9}" style="width: calc(100% - 20px); padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;" inputmode="numeric">

    <label for="customerAddress" style="display: block; margin-bottom: 5px; font-weight: bold;">Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ ØªØ­ÙˆÛŒÙ„:</label>
    <textarea id="customerAddress" placeholder="Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚ØŒ Ø´Ø§Ù…Ù„ Ø§Ø³ØªØ§Ù†ØŒ Ø´Ù‡Ø±ØŒ Ø®ÛŒØ§Ø¨Ø§Ù†ØŒ Ú©ÙˆÚ†Ù‡ØŒ Ù¾Ù„Ø§Ú©ØŒ ÙˆØ§Ø­Ø¯ Ùˆ Ú©Ø¯ Ù¾Ø³ØªÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)" rows="4" required style="width: calc(100% - 20px); padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; resize: vertical;"></textarea>
  </div>
  <button onclick="sendOrder()">Ø«Ø¨Øª Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´</button>
  <button onclick="clearCart()" class="clear-cart-btn">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù„ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>
  <button onclick="showScreen('gallery')" style="background-color: #607d8b;">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ú¯Ø§Ù„Ø±ÛŒ</button>
</div>

<script>
const groupInfo = {
  1: {
    name: "Ø³Ø§ÛŒØ² Û²Û¹Ã—Û²Û± Ø¯ÙˆØ±ÙˆÚ†Ø§Ù¾",
    count: 22, // ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡
    price: 100000,
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù†Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ø¯ÙˆÙ… Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡
    filenames: ["Ø§Ù„ÙØ¨Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ.jpg", "Ø¬Ø¯ÙˆÙ„ ØªÙ†Ø§ÙˆØ¨ÛŒ Ø¹Ù†Ø§ØµØ±.jpg", "Ø§Ø¹Ø¯Ø§Ø¯ Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§ Ø³Ø§Ø¹Øª Ùˆ Ù…Ø­ÙˆØ±.jpg", "Ø¢Ù…ÙˆØ²Ø´ Ø§Ø¹Ø¯Ø§Ø¯.jpg", "Ø¢Ù…ÙˆØ²Ø´ Ø²Ù…Ø§Ù† Ùˆ Ø³Ø§Ø¹Øª.jpg", "Ø¢Ù…ÙˆØ²Ø´ Ø²Ù…Ø§Ù† ÙˆØ³Ø§Ø¹Øª 2.jpg", "Ø¢Ù…ÙˆØ²Ø´ Ø¶Ø±Ø¨ Ùˆ ØªÙ‚Ø³ÛŒÙ….jpg", "ØªÙ…Ø±ÛŒÙ† Ø¶Ø±Ø¨ Ùˆ ØªÙ‚Ø³ÛŒÙ….jpg", "Ø¬Ø¯ÙˆÙ„ Ø¯ÙˆØ³ØªÛŒ ØªÙ…Ø±ÛŒÙ†ÛŒ.jpg", "Ø¬Ø¯ÙˆÙ„ Ø¯ÙˆØ³ØªÛŒ Ú©Ø§Ù…Ù„.jpg", "Ø­Ø³Ø§Ø¨ Ø¢Ù…ÙˆØ² Ø§ÙˆÙ„ (Ø§ÙÙ‚ÛŒ).jpg", "Ø­Ø³Ø§Ø¨ Ø¢Ù…ÙˆØ² Ø§ÙˆÙ„ (Ø¹Ù…ÙˆØ¯ÛŒ).jpg", "Ø­Ø³Ø§Ø¨ Ø¢Ù…ÙˆØ² Ø¯ÙˆÙ… (Ø§ÙÙ‚ÛŒ).jpg", "Ø­Ø³Ø§Ø¨ Ø¢Ù…ÙˆØ² Ø¯ÙˆÙ… (Ø¹Ù…ÙˆØ¯ÛŒ).jpg", "Ø­Ø³Ø§Ø¨ Ø¢Ù…ÙˆØ² Ù¾Ø§ÛŒÙ‡ Ø³ÙˆÙ….jpg", /*"Ø­Ø³Ø§Ø¨ Ø¢Ù…ÙˆØ² Ú†Ù‡Ø§Ø±Ù… Ùˆ Ù¾Ù†Ø¬Ù….jpg"*/, "Ø¶Ø±Ø¨ Ùˆ ØªÙ…Ø±ÛŒÙ† Ø¶Ø±Ø¨.jpg", /*"Ø¢Ù…ÙˆØ²Ø´ Ø¶Ø±Ø¨ Ùˆ ØªÙ‚Ø³ÛŒÙ… Ø­ÛŒÙˆØ§Ù†Ø§Øª.jpg"*/, "Ù…Ø­ÛŒØ· Ùˆ Ù…Ø³Ø§Ø­Øª Ø§Ø´Ú©Ø§Ù„ Ù‡Ù†Ø¯Ø³ÛŒ.jpg", /*"Ø¢Ù…ÙˆØ²Ø´ Ø¬Ù…Ø¹ Ùˆ ØªÙØ±ÛŒÙ‚.jpg"*/, /*"Ù†Ù‚Ø´Ù‡ Ø§ÛŒØ±Ø§Ù† Ùˆ Ø¬Ù‡Ø§Ù†.jpg"*/, /*"Ø¬Ø¯ÙˆÙ„ ØªÙ‚Ø±ÛŒØ¨ Ø§Ø¹Ø¯Ø§Ø¯.jpg"*/]
  },
  2: {
    name: "Ø³Ø§ÛŒØ² ÛµÛ°Ã—Û³Ûµ ÛŒÚ©Ø±ÙˆÚ†Ø§Ù¾",
    count: 4, // ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡
    price: 100000,
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù†Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ø¯ÙˆÙ… Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡
    filenames: ["Ø§Ù„ÙØ¨Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø´Ú©Ù„ ØµØ¯Ø§Ù‡Ø§.jpg", "Ø¬Ø¯ÙˆÙ„ Ø¯ÙˆØ³ØªÛŒ.jpg", "Ø¬Ø¯ÙˆÙ„ Ø¶Ø±Ø¨ Ú©Ø¯ 350.jpg", "Ø¬Ø¯ÙˆÙ„ Ø¶Ø±Ø¨ Ú©Ø¯ 351.jpg"]
  },
  3: {
    name: "Ø³Ø§ÛŒØ² ÛµÛ°Ã—Û³Ûµ Ø¯ÙˆØ±ÙˆÚ†Ø§Ù¾",
    count: 9, // ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡
    price: 200000,
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù†Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ø¯ÙˆÙ… Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡
    filenames: ["Ø§Ø¹Ø¯Ø§Ø¯ Ù‡Ù…Ø±Ø§Ù‡ Ø³Ø§Ø¹Øª Ùˆ Ù…Ø­ÙˆØ±.jpg", "Ø§Ù„ÙØ¨Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ.jpg", "Ø¢Ù…ÙˆØ²Ø´ Ø¶Ø±Ø¨ Ùˆ ØªÙ‚Ø³ÛŒÙ….jpg", "ØªÙ…Ø±ÛŒÙ† Ø¶Ø±Ø¨ Ùˆ ØªÙ‚Ø³ÛŒÙ….jpg", "Ø¬Ø¯ÙˆÙ„ ØªÙ†Ø§ÙˆØ¨ÛŒ Ø¹Ù†Ø§ØµØ±.jpg", "Ø¬Ø¯ÙˆÙ„ Ø¬Ù…Ø¹ Ùˆ ØªÙØ±ÛŒÙ‚.jpg", "Ø¬Ø¯ÙˆÙ„ Ø¯ÙˆØ³ØªÛŒ ØªÙ…Ø±ÛŒÙ†ÛŒ.jpg", "Ø¬Ø¯ÙˆÙ„ Ø¯ÙˆØ³ØªÛŒ Ú©Ø§Ù…Ù„.jpg", "Ø¢Ù…ÙˆØ²Ø´ Ø²Ù…Ø§Ù† Ùˆ Ø³Ø§Ø¹Øª.jpg"]
  },
  4: {
    name: "Ø³Ø§ÛŒØ² Û·Û°Ã—ÛµÛ° ÛŒÚ©Ø±ÙˆÚ†Ø§Ù¾",
    count: 12, // ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡
    price: 200000,
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù†Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ø¯ÙˆÙ… Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡
    filenames: ["Ø§Ù„ÙØ¨Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ  Ø´Ú©Ù„ Ø¯Ø§Ø±.jpg", "Ø§Ù„ÙØ¨Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ø¨Ø¯ÙˆÙ† Ø´Ú©Ù„.jpg", "Ø§Ø¹Ø¯Ø§Ø¯ 1 ØªØ§ 100.jpg", "Ø§Ø¹Ø¯Ø§Ø¯ Ø¯Ù‡ Ø¯Ù‡ÛŒ.jpg", "Ø§Ø¹Ø¯Ø§Ø¯ ÛŒÚ© ØªØ§ Ø¯Ù‡.jpg", "Ø§Ù„ÙØ¨Ø§ÛŒ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ.jpg", "Ø¬Ø¯ÙˆÙ„ Ø¬Ù…Ø¹.jpg", "Ø¬Ø¯ÙˆÙ„ ØªÙØ±ÛŒÙ‚.jpg", "Ø¬Ø¯ÙˆÙ„ Ø¶Ø±Ø¨.jpg", "Ø¬Ø¯ÙˆÙ„ ØªÙ‚Ø³ÛŒÙ….jpg", "Ø¬Ø¯ÙˆÙ„ ØªÙ†Ø§ÙˆØ¨ÛŒ Ø¹Ù†Ø§ØµØ±.jpg", "Ø¬Ø¯ÙˆÙ„ Ø¯ÙˆØ³ØªÛŒ.jpg"]
  },
  5: {
    name: "Ø³Ø§ÛŒØ² Û·Û°Ã—ÛµÛ° ÛŒÙˆÙˆÛŒâ€ŒØ¯Ø§Ø±",
    count: 15, // ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡
    price: 250000,
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù†Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ø¯ÙˆÙ… Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡
    filenames: ["Ø´Ù‡Ø±Ú© Ø§Ù„ÙØ¨Ø§.jpg", "Ø¬Ø¯ÙˆÙ„ Ø¯ÙˆØ³ØªÛŒ ØªÙ…Ø±ÛŒÙ†ÛŒ.jpg", "Ø¢Ù†Ø§ØªÙˆÙ…ÛŒ Ø¨Ø¯Ù† Ø§Ù†Ø³Ø§Ù†.jpg", "Ø¨Ø¯Ù† Ù…Ù†.jpg", "Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡.jpg", "Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ.jpg", "Ø´Ú©Ù„ ØµØ¯Ø§Ù‡Ø§ Ùˆ Ø§Ù„ÙØ¨Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ.jpg", "Ø¢Ù…ÙˆØ²Ø´ Ø²Ù…Ø§Ù† ÙˆØ³Ø§Ø¹Øª.jpg", "Ø¶Ø±Ø¨ ØªÙ…Ø±ÛŒÙ†ÛŒ Ø³ØªÙˆÙ†ÛŒ.jpg", "Ø¶Ø±Ø¨ ØªÙ…Ø±ÛŒÙ†ÛŒ Ù…Ø±Ø¨Ø¹ÛŒ.jpg", "Ù…Ø­ÛŒØ· Ùˆ Ù…Ø³Ø§Ø­Øª Ø§Ø´Ú©Ø§Ù„ Ù‡Ù†Ø¯Ø³ÛŒ.jpg", "Ù…Ù†Ø¸ÙˆÙ…Ù‡ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ.jpg", "Ù†Ù‚Ø´Ù‡ Ø§ÛŒØ±Ø§Ù†.jpg", "Ù†Ù‚Ø´Ù‡ Ø¬Ù‡Ø§Ù†.jpg", /*"Ø¬Ø¯ÙˆÙ„ Ø¶Ø±Ø¨ Ø­ÛŒÙˆØ§Ù†Ø§Øª.jpg"*/]
  },
  6: {
    name: "Ø³Ø§ÛŒØ± Ù…Ø­ØµÙˆÙ„Ø§Øª",
        images: [
            { filename: "ÙÙ„Ø´ Ú©Ø§Ø±Øª Ø¶Ø±Ø¨.jpeg", name: "ÙÙ„Ø´ Ú©Ø§Ø±Øª Ø¶Ø±Ø¨", price: 180000 },
            { filename: "ÙÙ„Ø´ Ú©Ø§Ø±Øª Ø§Ù„ÙØ¨Ø§.jpeg", name: "ÙÙ„Ø´ Ú©Ø§Ø±Øª Ø§Ù„ÙØ¨Ø§", price: 120000 },
            /*{ filename: "ÙÙ„Ø´ Ú©Ø§Ø±Øª Ø¯ÙˆØ³ØªÛŒ.jpeg", name: "ÙÙ„Ø´ Ú©Ø§Ø±Øª Ø¯ÙˆØ³ØªÛŒ", price: 180000 },*/
            /*{ filename: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ú©ÙˆÚ†Ú© Ø¶Ø±Ø¨.jpeg", name: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ú©ÙˆÚ†Ú© Ø¶Ø±Ø¨", price: 220000 },*/
            { filename: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ú©ÙˆÚ†Ú© Ø§Ù„ÙØ¨Ø§.jpeg", name: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ú©ÙˆÚ†Ú© Ø§Ù„ÙØ¨Ø§", price: 220000 },
            { filename: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ú©ÙˆÚ†Ú© Ø¯ÙˆØ³ØªÛŒ.jpeg", name: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ú©ÙˆÚ†Ú© Ø¯ÙˆØ³ØªÛŒ", price: 220000 },
            { filename: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ø¶Ø±Ø¨.jpeg", name: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ø¶Ø±Ø¨", price: 280000 },
            { filename: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ø§Ù„ÙØ¨Ø§.jpeg", name: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ø§Ù„ÙØ¨Ø§", price: 280000 },
            { filename: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ø¯ÙˆØ³ØªÛŒ.jpeg", name: "Ø¯ÙØªØ±Ú†Ù‡ Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ø¯ÙˆØ³ØªÛŒ", price: 280000 },
            { filename: "ÙÙ„Ø´ Ú©Ø§Ø±Øª Ø§Ø¹Ø¯Ø§Ø¯.jpeg", name: "ÙÙ„Ø´ Ú©Ø§Ø±Øª Ø§Ø¹Ø¯Ø§Ø¯", price: 200000, qtyMultiplier: 10 }, // Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù…Ø¶Ø±Ø¨ 10
            // ... Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨ÛŒØ´ØªØ±ÛŒ Ø±Ø§ Ø¨Ø§ Ù†Ø§Ù… Ùˆ Ù‚ÛŒÙ…Øª Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
        ],
        type: "variable-count", // Ù†ÙˆØ¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ ØªØ¹Ø¯Ø§Ø¯ Ù…ØªØºÛŒØ±
        defaultQtyMultiplier: 12 // Ù…Ø¶Ø±Ø¨ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡
    }
};

// Quantities must be sorted ascending
const allowedQuantities = [0, 10, 20, 50, 100, 200, 300, 400, 500];
let cart = new Map(JSON.parse(localStorage.getItem('cart') || '[]'));

// --- Screen Management ---
const screens = {
    main: document.getElementById('mainSection'),
    gallery: document.getElementById('gallery'),
    cart: document.getElementById('cartSection')
};

function showScreen(screenName) {
    // Hide all screens
    for (let key in screens) {
        screens[key].style.display = 'none';
    }

    // Show the requested screen
    screens[screenName].style.display = 'flex'; // Use flex for these sections

    // Update history for back button support
    // Only push state if not going back via popstate or already on the screen
    if (history.state === null || history.state.screen !== screenName) {
        history.pushState({ screen: screenName }, '', `#${screenName}`);
    }

    // Specific actions for each screen
    if (screenName === 'gallery') {
        const currentGroupId = document.getElementById('bottomGroupSelect').value; // Get current selected group
        loadGroup(currentGroupId); // Reload current group
    } else if (screenName === 'cart') {
        renderCartList();
    }
}

// Handle browser's back button
window.addEventListener('popstate', (event) => {
    if (event.state && event.state.screen) {
        // Restore previous screen based on history state
        for (let key in screens) {
            screens[key].style.display = 'none';
        }
        screens[event.state.screen].style.display = 'flex';
        if (event.state.screen === 'gallery') {
            const currentGroupId = document.getElementById('bottomGroupSelect').value;
            loadGroup(currentGroupId);
        } else if (event.state.screen === 'cart') {
            renderCartList();
        }
    } else {
        // Fallback to main screen if no state (e.g., initial load or direct URL)
        showScreen('main');
    }
});


function enterAsUser() {
  showScreen('gallery');
  // Sync selected group in both dropdowns
  loadGroup(1); // Load the first group by default
}

function showAdminLogin() {
  // Hide initial login button and address/subtitle
  document.getElementById("loginSection").style.display = "none";
  document.getElementById("subtitle").style.display = "none";
  document.getElementById("address").style.display = "none";
  // Show admin login form
  document.getElementById("adminLogin").style.display = "flex";
}

function loginAsAdmin() {
  const pass = document.getElementById("adminPassword").value;
  if (pass === "Alireza55") {
    alert("Ø¹Ù„ÛŒØ±Ø¶Ø§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!");
    // You might want to navigate to an admin panel or hide this form
    // For now, it just shows an alert
  } else {
    alert("ÙˆØ±ÙˆØ¯ Ø´Ù…Ø§ Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª");
  }
}

function changeGroup(val) {
  // Sync both dropdowns when one changes
  document.getElementById('bottomGroupSelect').value = val;
  document.getElementById('bottomGroupSelect').value = val;
  loadGroup(parseInt(val));
}

// ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ dropdown ØªØ¹Ø¯Ø§Ø¯
function generateQuantityOptions(selectedQty, qtyMultiplier = 1) { // Ù¾Ø§Ø±Ø§Ù…ØªØ± qtyMultiplier Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ØŒ Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ 1
    let optionsHtml = '';
    // Ø§Ú¯Ø± qtyMultiplier Ø¨ÛŒØ´ØªØ± Ø§Ø² 1 Ø¨Ø§Ø´Ù‡ØŒ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÙˆÙ† ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    if (qtyMultiplier > 1) {
        // Ø§Ø² 0 Ø¨Ø±Ø§ÛŒ Ú¯Ø²ÛŒÙ†Ù‡ "Ø­Ø°Ù" Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…ØŒ Ø¨Ø¹Ø¯ Ø§Ø² Ø§ÙˆÙ† Ø§Ø² Ø®ÙˆØ¯ Ù…Ø¶Ø±Ø¨ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ
        optionsHtml += `<option value="0" ${selectedQty === 0 ? 'selected' : ''}>0</option>`;
        for (let i = qtyMultiplier; i <= 5000; i += qtyMultiplier) { // ØªØ§ 5000 Ø¹Ø¯Ø¯ ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒØ´Ù‡ØŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ Ø­Ø¯Ø§Ú©Ø«Ø± Ø±Ùˆ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯
            optionsHtml += `<option value="${i}" ${i === selectedQty ? 'selected' : ''}>${i}</option>`;
        }
    } else {
        // Ù…Ù†Ø·Ù‚ Ù‚Ø¨Ù„ÛŒ Ø¨Ø±Ø§ÛŒ allowedQuantities Ø«Ø§Ø¨Øª
        allowedQuantities.forEach(qty => {
            optionsHtml += `<option value="${qty}" ${qty === selectedQty ? 'selected' : ''}>${qty}</option>`;
        });
    }
    return optionsHtml;
}

function loadGroup(groupId) {
    const container = document.getElementById("imagesContainer");
    container.innerHTML = ""; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªØµØ§ÙˆÛŒØ± Ù‚Ø¨Ù„ÛŒ
    const info = groupInfo[groupId]; // Ø§ÛŒÙ† 'info' Ø¢Ø¨Ø¬Ú©Øª Ú¯Ø±ÙˆÙ‡ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§Ø³Øª

    // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ú©Ù‡ Ø¢ÛŒØ§ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ø§Ø² Ù†ÙˆØ¹ 'variable-count' Ù‡Ø³Øª ÛŒØ§ Ù†Ù‡
    const isVariableCountGroup = info.type === 'variable-count';

    // ÛŒÚ© Ø¢Ø±Ø§ÛŒÙ‡ Ù…ØªØ­Ø¯ Ø¨Ø±Ø§ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ØªØ§ Ø­Ù„Ù‚Ù‡ forEach Ø¨Ù‡ ØµÙˆØ±Øª ÛŒÚ©Ø³Ø§Ù† Ú©Ø§Ø± Ú©Ù†Ù‡
    const itemsToRender = isVariableCountGroup ? info.images : info.filenames.map(f => ({
        filename: f,
        name: f.replace(/\.jpg$/, ''),
        price: info.price
    }));

    itemsToRender.forEach(item => {
        const filename = item.filename;
        const itemName = item.name;
        const itemPrice = item.price;
        
        const imagePath = `Image/${info.name}/${filename}`; 

        const itemUniqueId = `${groupId}-${filename}`;
        const currentCartItem = cart.get(itemUniqueId);
        // ØªØ¹Ø¯Ø§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡: Ø§Ú¯Ø± Ø¯Ø± Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¨ÙˆØ¯ØŒ Ø§Ø² ØªØ¹Ø¯Ø§Ø¯ Ø§ÙˆÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒØ´Ù‡ØŒ Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±Øª 0.
        const initialQty = currentCartItem ? currentCartItem.qty : 0; 

        const box = document.createElement("div");
        box.className = "image-box";

        let inCartMessage = '';
        if (currentCartItem && currentCartItem.qty > 0) {
            inCartMessage = `<p class="in-cart-display">Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø³Ø¨Ø¯: ${currentCartItem.qty} Ø¹Ø¯Ø¯</p>`;
        }

        let quantityControlHtml = '';
        // Ø­Ø§Ù„Ø§ Ù‡Ø± Ø¯Ùˆ Ù†ÙˆØ¹ Ú¯Ø±ÙˆÙ‡ Ø§Ø² select Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯ØŒ Ø§Ù…Ø§ Ø¨Ø§ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ØªÙØ§ÙˆØª
        // Ù…Ø¶Ø±Ø¨ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¢ÛŒØªÙ…: Ø§Ú¯Ø± Ø¯Ø± Ú¯Ø±ÙˆÙ‡ variable-count Ø¨ÙˆØ¯ØŒ Ø§Ø² Ù…Ø¶Ø±Ø¨ Ø®Ø§Øµ Ù…Ø­ØµÙˆÙ„ ÛŒØ§ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ú¯Ø±ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…. Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±Øª 1.
        const qtyMultiplier = isVariableCountGroup ? (item.qtyMultiplier || info.defaultQtyMultiplier || 1) : 1;

        quantityControlHtml = `
            <div style="display: flex; align-items: center; margin-top: 10px;">
                <label for="qty-select-${itemUniqueId}">ØªØ¹Ø¯Ø§Ø¯:</label>
                <select id="qty-select-${itemUniqueId}" class="quantity-select" onchange="addToCart('${groupId}', '${filename}')">
                    ${generateQuantityOptions(initialQty, qtyMultiplier)}
                </select>
                <button onclick="addToCart('${groupId}', '${filename}')">Ø§ÙØ²ÙˆØ¯Ù†â€Œ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>
            </div>
        `;

        box.innerHTML = `
            <img src="${imagePath}" alt="${itemName}">
            <p style="font-weight: bold; margin-bottom: 5px;">${itemName}</p> 
            <p style="color: #4CAF50; font-weight: bold;">Ù‚ÛŒÙ…Øª: ${itemPrice.toLocaleString()} Ø±ÛŒØ§Ù„</p>
            ${quantityControlHtml}
            ${inCartMessage}
        `;
        container.appendChild(box);
    });

    document.getElementById('gallery').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// ØªØ§Ø¨Ø¹ updateGalleryItemQuantity Ø¯ÛŒÚ¯Ø± Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ù†ÛŒØ³Øª Ùˆ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯.
// Ø²ÛŒØ±Ø§ ØªØºÛŒÛŒØ±Ø§Øª Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø§Ø² onchange Ø¯Ø± select Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.
// Ø§Ú¯Ø± Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¯Ø± Ø¬Ø§ÛŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ø¢Ù† Ø±Ø§ Ø§Ø² Ú©Ø¯ Ø®ÙˆØ¯ Ø­Ø°Ù Ú©Ù†ÛŒØ¯.

// **ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯:** Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØªØºÛŒÛŒØ±Ø§Øª ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø± ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ (Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ variable-count)
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ÙÙ‚Ø· Ù…Ù‚Ø¯Ø§Ø± ÙˆØ±ÙˆØ¯ÛŒ Ø±Ùˆ Ø¨Ù‡ addToCart Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ù‡.
function updateGalleryItemQuantity(groupId, filename, quantity) {
    addToCart(groupId, filename, quantity); // Ù…Ù†Ø·Ù‚ addToCart Ø±Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…

  // Ø¨Ø¹Ø¯ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ Ú¯Ø±ÙˆÙ‡ØŒ Ø¨Ù‡ Ø¨Ø§Ù„Ø§ÛŒ Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§Ø³Ú©Ø±ÙˆÙ„ Ú©Ù†ÛŒØ¯
  // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù‡ Ø®ÙˆØ¯ imagesContainer ÛŒØ§ Ø¨Ù‡ Ú©Ù„ Ú¯Ø§Ù„Ø±ÛŒ (gallery) Ø§Ø³Ú©Ø±ÙˆÙ„ Ú©Ù†ÛŒØ¯.
  // Ø¨Ù‡ØªØ±Ù‡ Ø¨Ù‡ Ø®ÙˆØ¯ Ú¯Ø§Ù„Ø±ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ú©Ù†ÛŒÙ… Ú©Ù‡ Ù‡Ø¯Ø± Ùˆ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ Ù‡Ù… Ø¯ÛŒØ¯Ù‡ Ø¨Ø´Ù†.
  document.getElementById('gallery').scrollIntoView({ behavior: 'smooth', block: 'start' });

}

function addToCart(groupId, filename) {
    const info = groupInfo[groupId];
    const itemUniqueId = `${groupId}-${filename}`;
    
    const isVariableCountGroup = info.type === 'variable-count'; // Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ Ú¯Ø±ÙˆÙ‡ (Ø¬Ù‡Øª Ø¯Ø±ÛŒØ§ÙØª Ù…Ø¶Ø±Ø¨)
    
    // Ù‡Ù…ÛŒØ´Ù‡ Ø§Ø² select Ù…Ù‚Ø¯Ø§Ø± Ø±Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†ÛŒÙ…
    const qtySelect = document.getElementById(`qty-select-${itemUniqueId}`);
    const selectedQty = parseInt(qtySelect.value);

    // Ù…Ø¶Ø±Ø¨ ØµØ­ÛŒØ­ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    let qtyMultiplier = 1; // Ù¾ÛŒØ´â€ŒÙØ±Ø¶ 1 Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¹Ù…ÙˆÙ„ÛŒ
    if (isVariableCountGroup) {
        const itemInGroup = info.images.find(img => img.filename === filename);
        qtyMultiplier = itemInGroup ? (itemInGroup.qtyMultiplier || info.defaultQtyMultiplier) : info.defaultQtyMultiplier;
    }

    if (selectedQty === 0) { // Ø§Ú¯Ø± 0 Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯ØŒ ÛŒØ¹Ù†ÛŒ Ø­Ø°Ù Ø§Ø² Ø³Ø¨Ø¯
        if (cart.has(itemUniqueId)) {
            removeFromCart(itemUniqueId);
        }
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ "Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø³Ø¨Ø¯" Ø¨Ø¹Ø¯ Ø§Ø² Ø­Ø°Ù
        const inCartDisplayElement = qtySelect.parentNode.parentNode.querySelector('.in-cart-display');
        if (inCartDisplayElement) {
            inCartDisplayElement.remove();
        }
        return;
    }
    
    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…Ø¶Ø±Ø¨ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ variable-count)
    if (isVariableCountGroup && (selectedQty % qtyMultiplier !== 0)) {
        alert(`Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„ØŒ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§ÛŒØ¯ Ù…Ø¶Ø±Ø¨ÛŒ Ø§Ø² ${qtyMultiplier} Ø¨Ø§Ø´Ø¯.`);
        // Ø§Ú¯Ø± Ù…Ø¶Ø±Ø¨ Ø±Ø¹Ø§ÛŒØª Ù†Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ØŒ dropdown Ø±Ø§ Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± Ù‚Ø¨Ù„ÛŒ ÛŒØ§ 0 (Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù) Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†ÛŒÙ…
        qtySelect.value = cart.has(itemUniqueId) ? cart.get(itemUniqueId).qty : 0; 
        return;
    }

    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ù…Ø­ØµÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯
    const itemToAdd = isVariableCountGroup ? info.images.find(img => img.filename === filename) : {
        filename: filename,
        name: filename.replace(/\.jpg$/, ''),
        price: info.price
    };

    cart.set(itemUniqueId, {
        groupId: groupId,
        filename: filename,
        groupName: info.name,
        name: itemToAdd.name,
        price: itemToAdd.price,
        qty: selectedQty
    });
    
    saveCart();
    
    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ "Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø³Ø¨Ø¯" Ø¯Ø± ØµÙØ­Ù‡ Ú¯Ø§Ù„Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢ÛŒØªÙ… Ø®Ø§Øµ
    let inCartDisplayElement = qtySelect.parentNode.parentNode.querySelector('.in-cart-display');

    if (inCartDisplayElement) {
        inCartDisplayElement.textContent = `Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø³Ø¨Ø¯: ${selectedQty} Ø¹Ø¯Ø¯`;
    } else {
        const newInCartDisplay = document.createElement('p');
        newInCartDisplay.className = 'in-cart-display';
        newInCartDisplay.textContent = `Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø³Ø¨Ø¯: ${selectedQty} Ø¹Ø¯Ø¯`;
        qtySelect.parentNode.parentNode.appendChild(newInCartDisplay);
    }
}

function updateCartItemQuantityFromDropdown(selectElement, itemUniqueId) {
    let newQty = parseInt(selectElement.value);

    if (isNaN(newQty) || newQty < 0) {
        // This case should ideally not happen with a dropdown of fixed values
        console.error("Invalid quantity selected from dropdown.");
        renderCartList(); // Re-render to revert to last valid quantity
        return;
    }
    
    if (newQty === 0) {
        removeFromCart(itemUniqueId);
    } else {
        let item = cart.get(itemUniqueId);
        item.qty = newQty;
        cart.set(itemUniqueId, item);
        saveCart();
        renderCartList(); // Re-render cart list after update
    }
}

function removeFromCart(itemUniqueId) {
    if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„ Ø±Ø§ Ø§Ø² Ø³Ø¨Ø¯ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
        cart.delete(itemUniqueId);
        saveCart();
        renderCartList(); // Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø±Ø§ Ù¾Ø³ Ø§Ø² Ø­Ø°Ù Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø±Ù†Ø¯Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…

        // Ù‡Ù…Ú†Ù†ÛŒÙ† Ù†Ù…Ø§ÛŒØ´ Ú¯Ø§Ù„Ø±ÛŒ Ø±Ø§ Ø§Ú¯Ø± Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
        if (document.getElementById('gallery').style.display === 'flex') {
            const qtySelectInGallery = document.getElementById(`qty-select-${itemUniqueId}`);
            // qtyInputInGallery Ø¯ÛŒÚ¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ Ùˆ Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ø¢Ù† Ù†ÛŒØ³Øª.
            // Ø§Ú¯Ø± Ø®Ø·ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ qtyInputInGallery Ø¯Ø§Ø±ÛŒØ¯ØŒ Ø¢Ù† Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯.

            if (qtySelectInGallery) {
                qtySelectInGallery.value = 0; // dropdown Ø±Ø§ Ø¨Ù‡ 0 Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                const inCartDisplayElement = qtySelectInGallery.parentNode.parentNode.querySelector('.in-cart-display');
                if (inCartDisplayElement) {
                    inCartDisplayElement.remove(); // Ù¾ÛŒØ§Ù… "Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø³Ø¨Ø¯" Ø±Ø§ Ø­Ø°Ù Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                }
            }
        }
    }
}

function clearCart() {
    if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ù„ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ')) {
        cart.clear(); // Clear all items from the Map
        saveCart(); // Save the empty cart to localStorage
        renderCartList(); // Re-render the cart list to show it's empty
        alert('Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ù¾Ø§Ú© Ø´Ø¯.');
        // Also update the gallery view if currently displayed
        if (document.getElementById('gallery').style.display === 'flex') {
            loadGroup(document.getElementById('bottomGroupSelect').value); // Reload current group to reset all in-cart messages
        }
    }
}

function renderCartList() {
    const list = document.getElementById("cartList");
    const total = document.getElementById("totalPrice");
    list.innerHTML = ""; // Ù„ÛŒØ³Øª Ù‚Ø¨Ù„ÛŒ Ø±Ùˆ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†Ù‡
    let grouped = {}; // Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ØªÚ©ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡
    let groupedSummaries = {}; // Ø¨Ø±Ø§ÛŒ Ø®Ù„Ø§ØµÙ‡â€ŒÛŒ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§
    let totalSum = 0; // Ù…Ø¨Ù„Øº Ú©Ù„ Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø±Ø¨Ø±ÛŒ

    if (cart.size === 0) {
        list.innerHTML = "<p>Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</p>";
        total.textContent = `Ù…Ø¨Ù„Øº Ú©Ù„: 0 Ø±ÛŒØ§Ù„`;
        return;
    }

    cart.forEach(item => {
        // Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ØªÚ©ÛŒ
        if (!grouped[item.groupName]) grouped[item.groupName] = [];
        grouped[item.groupName].push(item);
        totalSum += item.qty * item.price;

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®Ù„Ø§ØµÙ‡â€ŒÛŒ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§
        if (!groupedSummaries[item.groupName]) {
            groupedSummaries[item.groupName] = {
                totalQty: 0,
                totalPrice: 0
            };
        }
        groupedSummaries[item.groupName].totalQty += item.qty;
        groupedSummaries[item.groupName].totalPrice += item.qty * item.price;
    });

    // Ø­Ø§Ù„Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ØªÚ©ÛŒØŒ Ù…Ø«Ù„ Ù‚Ø¨Ù„
    for (let groupName in grouped) {
        list.innerHTML += `<h4 style="margin-top: 15px; text-align: right; border-bottom: 1px dashed #eee; padding-bottom: 5px;">${groupName}</h4>`;
        grouped[groupName].forEach(item => {
            const itemUniqueId = `${item.groupId}-${item.filename}`;
            
            // --- Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ qtyMultiplierForCartItem Ø±Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù†ÛŒÙ… ---
            // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú¯Ø±ÙˆÙ‡ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ø±Ùˆ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            const group = groupInfo[item.groupId]; 
            let itemDetail = null;
            // Ø§Ú¯Ø± Ú¯Ø±ÙˆÙ‡ Ø§Ø² Ù†ÙˆØ¹ variable-count Ø¨ÙˆØ¯ØŒ Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­ØµÙˆÙ„ Ø±Ùˆ Ø§Ø² Ø¢Ø±Ø§ÛŒÙ‡ images Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            if (group.type === 'variable-count') {
                itemDetail = group.images.find(img => img.filename === item.filename);
            }
            // Ù…Ø¶Ø±Ø¨ Ø¨Ø±Ø§ÛŒ Ø¢ÛŒØªÙ… Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø±Ùˆ ØªØ¹ÛŒÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            // Ø§Ú¯Ø± Ø§Ø² Ù†ÙˆØ¹ variable-count Ù†Ø¨ÙˆØ¯ ÛŒØ§ Ù…Ø¶Ø±Ø¨ Ø®Ø§ØµÛŒ Ù†Ø¯Ø§Ø´ØªØŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ 1 Ø±Ùˆ Ù…ÛŒâ€ŒØ°Ø§Ø±ÛŒÙ…
            const qtyMultiplierForCartItem = itemDetail ? (itemDetail.qtyMultiplier || group.defaultQtyMultiplier || 1) : 1; 
            // --- Ù¾Ø§ÛŒØ§Ù† Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¶Ø±Ø¨ ---

            const itemDiv = document.createElement("div");
            itemDiv.className = "cart-item";
            itemDiv.innerHTML = `
                <div class="cart-item-info">
                    <p style="font-weight: bold; margin-bottom: 3px;"> ${item.filename.replace(/\.(jpeg|jpg)$/i, '')}</p>
                </div>
                <div class="quantity-control">
                    <select id="cart-qty-select-${itemUniqueId}" class="quantity-select"
                                onchange="updateCartItemQuantityFromDropdown(this, '${itemUniqueId}')">
                            ${generateQuantityOptions(item.qty, qtyMultiplierForCartItem)} 
                    </select>
                    <button class="remove-btn" onclick="removeFromCart('${itemUniqueId}')">Ø­Ø°Ù</button>
                </div>
            `;
            list.appendChild(itemDiv);
        });
    }

    // --- NEW LOCATION: Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡â€ŒÛŒ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† Ù„ÛŒØ³Øª Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ ---
    list.innerHTML += `<hr style="margin: 15px 0; border: 0; border-top: 1px dashed #ccc;">`; // ÛŒÚ© Ø®Ø· Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ Ù‚Ø¨Ù„ Ø§Ø² Ø®Ù„Ø§ØµÙ‡
    list.innerHTML += `<h3 style="margin-bottom: 10px;">Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ§Ø±Ø´ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú¯Ø±ÙˆÙ‡:</h3>`;
    for (let groupName in groupedSummaries) {
        const summary = groupedSummaries[groupName];
        list.innerHTML += `
            <div style="background-color: #e8f5e9; padding: 8px; margin-bottom: 5px; border-radius: 5px; text-align: right;">
                <p style="font-weight: bold; margin: 0;">${groupName}:</p>
                <p style="margin: 0; font-size: 0.9em;">ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„: ${summary.totalQty} Ø¹Ø¯Ø¯ - Ù…Ø¬Ù…ÙˆØ¹ Ù‚ÛŒÙ…Øª: ${summary.totalPrice.toLocaleString()} Ø±ÛŒØ§Ù„</p>
            </div>
        `;
    }
    // ÛŒÚ© Ø®Ø· Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ Ø¯ÛŒÚ¯Ø± Ø¨Ø¹Ø¯ Ø§Ø² Ø®Ù„Ø§ØµÙ‡ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
    list.innerHTML += `<hr style="margin: 15px 0; border: 0; border-top: 1px dashed #ccc;">`; 


    // --- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§Ø±Ø¨Ø±ÛŒ Ø¯Ø± Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ ---
    const baseShippingThreshold = 85000000; 
    const costPerThreshold = 600000; Â  Â  
    let calculatedShippingCost = 0;
    let shippingDisplayMessage = "";
    
    if (totalSum === 0) {
        calculatedShippingCost = 0;
        shippingDisplayMessage = `\nğŸšš Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§Ø±Ø¨Ø±ÛŒ: 0 Ø±ÛŒØ§Ù„`;
    } else {
        const numberOfThresholds = Math.ceil(totalSum / baseShippingThreshold);
        calculatedShippingCost = numberOfThresholds * costPerThreshold;
        shippingDisplayMessage = `\nğŸšš Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§Ø±Ø¨Ø±ÛŒ (${numberOfThresholds} Ø¨Ø³ØªÙ‡): ${calculatedShippingCost.toLocaleString()} Ø±ÛŒØ§Ù„ `;
    }

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
    list.innerHTML += `
        <div style="padding: 8px; margin-top: 10px; border-radius: 5px; text-align: right;">
            <p style="font-weight: bold; margin: 0;">${shippingDisplayMessage}</p>
        </div>
    `;
    // --- Ù†Ù…Ø§ÛŒØ´ Ù…Ø¨Ù„Øº Ú©Ù„ Ù†Ù‡Ø§ÛŒÛŒ (Ø´Ø§Ù…Ù„ Ø¨Ø§Ø±Ø¨Ø±ÛŒ) ---
    const finalTotalWithShipping = totalSum + calculatedShippingCost;
    total.textContent = `ğŸ’µ Ù…Ø¨Ù„Øº Ú©Ù„ Ø³ÙØ§Ø±Ø´: ${finalTotalWithShipping.toLocaleString()} Ø±ÛŒØ§Ù„`;
}


function saveCart() {
  localStorage.setItem('cart', JSON.stringify(Array.from(cart.entries())));
}
function sendOrder() {
  if (cart.size === 0) {
    alert('Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.');
    return;
  }

  // Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ Ø§Ø² ÙØ±Ù…
  const customerName = document.getElementById('customerName').value.trim();
  const customerPhone = document.getElementById('customerPhone').value.trim();
  const customerAddress = document.getElementById('customerAddress').value.trim();

  // Ø§Ø¹ØªØ¨Ø§Ø± Ø³Ù†Ø¬ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ
  if (!customerName || !customerPhone || !customerAddress) {
    alert('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒØŒ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ùˆ Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ ØªØ­ÙˆÛŒÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
    return; // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø¯Ø§Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´
  }

  // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ Ø¯Ø± localStorage Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø¹Ø¯ÛŒ
  localStorage.setItem('customerName', customerName);
  localStorage.setItem('customerPhone', customerPhone);
  localStorage.setItem('customerAddress', customerAddress);

  const confirmation = confirm('Ø¢ÛŒØ§ Ø§Ø² Ø«Ø¨Øª Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´ Ø®ÙˆØ¯ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ');

  if (confirmation) {
    let message = "ğŸ›’ Ø³ÙØ§Ø±Ø´ Ù…Ù† :  \n";

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ Ø¨Ù‡ Ø§Ø¨ØªØ¯Ø§ÛŒ Ù¾ÛŒØ§Ù…
    message += `\nğŸ‘¤ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ: ${customerName}\n`;
    message += `ğŸ“± Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„: ${customerPhone}\n`;
    message += `ğŸ“ Ø¢Ø¯Ø±Ø³ ØªØ­ÙˆÛŒÙ„: ${customerAddress}\n`;

    let totalAmount = 0;
    let groupedItems = {};
    let groupedSummaries = {};

    cart.forEach(item => {
      // 1. For displaying item details by group
      if (!groupedItems[item.groupName]) {
        groupedItems[item.groupName] = [];
      }
      groupedItems[item.groupName].push(item);

      // 2. For calculating the final total amount of the shopping cart
      totalAmount += item.qty * item.price;

      // 3. For calculating the summary of each group (total quantity and total price)
      if (!groupedSummaries[item.groupName]) {
        groupedSummaries[item.groupName] = {
          totalQty: 0,
          totalPrice: 0
        };
      }
      groupedSummaries[item.groupName].totalQty += item.qty;
      groupedSummaries[item.groupName].totalPrice += item.qty * item.price;
    });

    // --- Display full item details (grouped) ---
    message += "\n--- Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´ ---\n";
    for (let groupName in groupedItems) {
      message += `\nâ¤µï¸  ${groupName} ğŸ”€ :\n`; // Added group title
      groupedItems[groupName].forEach(item => {
        message += ` Â - ${item.filename.replace(/\.(jpeg|jpg)$/i, '')} - ØªØ¹Ø¯Ø§Ø¯: ${item.qty} Ø¹Ø¯Ø¯\n`; // Item details with indent
      });
    }
    message += "---------------------------------------\n";
    // --- Display order summary by group ---
    message += "\n--- Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ§Ø±Ø´ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú¯Ø±ÙˆÙ‡ ---\n";
    for (let groupName in groupedSummaries) {
      const summary = groupedSummaries[groupName];
      message += `* ${groupName}: ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ ${summary.totalQty} Ø¹Ø¯Ø¯ - Ù…Ø¬Ù…ÙˆØ¹ Ù‚ÛŒÙ…Øª ${summary.totalPrice.toLocaleString()} Ø±ÛŒØ§Ù„\n`;
    }
    message += "---------------------------------------\n"; // Adjusted line separator

    // --- Calculate and add variable/tiered shipping cost ---
    const baseShippingThreshold = 85000000; // 85,000,000 Rials (per tier)
    const costPerThreshold = 600000; Â  Â  // 600,000 Rials (cost for each tier)

    let calculatedShippingCost = 0;
    let shippingMessage = "";
    let finalTotalAmount = totalAmount; // Final amount including shipping

    // If totalAmount is zero (empty cart), shipping is zero.
    if (totalAmount === 0) {
      calculatedShippingCost = 0;
      shippingMessage = "\nğŸšš Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§Ø±Ø¨Ø±ÛŒ: 0 Ø±ÛŒØ§Ù„";
    }
    // If totalAmount is greater than zero, calculate tiers
    else {
      // Calculate the number of full or partial thresholds reached.
      const numberOfThresholds = Math.ceil(totalAmount / baseShippingThreshold);
      calculatedShippingCost = numberOfThresholds * costPerThreshold;
      shippingMessage = `\nğŸšš Ù‡Ø²ÛŒÙ†Ù‡â€ŒØ¨Ø§Ø±Ø¨Ø±ÛŒâ€Œ(â€Œ${numberOfThresholds} Ø¨Ø³ØªÙ‡) : ${calculatedShippingCost.toLocaleString()} Ø±ÛŒØ§Ù„ `;
    }

    finalTotalAmount += calculatedShippingCost; // Add shipping cost to the final total

    message += shippingMessage; // Add the shipping message above the total amount


    // --- Display final total amount and supplementary messages ---
    message += `\nğŸ’µ Ù…Ø¨Ù„Øº Ú©Ù„ Ø³ÙØ§Ø±Ø´: ${finalTotalAmount.toLocaleString()} Ø±ÛŒØ§Ù„`; // Use finalTotalAmount
    message += " Â  Â  Â  ---------------------------------------\n";
    message += `\n\nâœ… Â Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯ . Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ù„Ø§Ø²Ù… Ø¨Ø§ Ø´Ù…Ø§ ØµÙˆØ±Øª Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯.`;

    const phoneNumber = "989010195885"; // Iranian WhatsApp number (with 98 prefix)
    const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;

    window.open(whatsappUrl, '_blank');
  } else {
    // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø±ÙˆÛŒ "Cancel" ÛŒØ§ "Ù„ØºÙˆ" Ú©Ù„ÛŒÚ© Ú©Ø±Ø¯
    alert('Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ù„ØºÙˆ Ø´Ø¯.');
  }
}
// Initial load: show main screen and add initial history state
window.onload = function() {
    showScreen('main');
    // Ensure the initial state is also recorded for history API
    history.replaceState({ screen: 'main' }, '', '#main');
    // Load any existing cart items to ensure gallery quantities are correct on load
    renderCartList(); // This also initializes the cart display if empty
};

</script>
</div>
<footer class="mt-auto py-6 text-gray-500 text-sm">
    <p>&copy; All rights reserved for PosterIran2025</p>
</footer>
<script>
  </script>
<footer class="mt-auto py-6 text-gray-500 text-sm">
    <p> </p>
</footer>
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('Service Worker registered! Scope:', registration.scope);
                })
                .catch(err => {
                    console.log('Service Worker registration failed:', err);
                });
        });
    }
</script>

</body>
</html>
